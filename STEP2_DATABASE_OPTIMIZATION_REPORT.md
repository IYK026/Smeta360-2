# üìà –û—Ç—á–µ—Ç –ø–æ –®–∞–≥—É 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 2.1 –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π PostgreSQL ‚úÖ 
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**: —É–≤–µ–ª–∏—á–µ–Ω–æ —Å 10 –¥–æ 20
- **–¢–∞–π–º–∞—É—Ç –ø—Ä–æ—Å—Ç–æ—è**: 30 —Å–µ–∫—É–Ω–¥ (–æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è –æ–±–ª–∞—á–Ω–æ–π –ë–î)
- **–¢–∞–π–º–∞—É—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è**: 2 —Å–µ–∫—É–Ω–¥—ã (–±—ã—Å—Ç—Ä—ã–π fallback)
- **Keep-alive**: –≤–∫–ª—é—á–µ–Ω –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—É–ª–∞**: –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π connect/release/error

### 2.2 –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã ‚úÖ
–°–æ–∑–¥–∞–Ω—ã **8 –≤—ã—Å–æ–∫–æ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤**:

#### –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (GIN + —Ç—Ä–∏–≥—Ä–∞–º–º—ã)
- ‚úÖ `idx_materials_name_trgm` - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
- ‚úÖ `idx_works_ref_name_trgm` - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é  
- ‚úÖ `pg_trgm` —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ

#### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è JOIN –æ–ø–µ—Ä–∞—Ü–∏–π  
- ‚úÖ `idx_customer_estimates_user_id` - –≤—ã–±–æ—Ä–∫–∞ —Å–º–µ—Ç –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- ‚úÖ `idx_customer_estimate_items_estimate_id` - —ç–ª–µ–º–µ–Ω—Ç—ã —Å–º–µ—Ç –ø–æ —Å–º–µ—Ç–µ
- ‚úÖ `idx_construction_projects_user_id` - –ø—Ä–æ–µ–∫—Ç—ã –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

#### Auth —Å–∏—Å—Ç–µ–º–∞
- ‚úÖ `idx_auth_users_email_fast` - –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ email
- ‚úÖ `idx_customer_estimates_created_at` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ

### 2.3 –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ ‚úÖ
- **ILIKE –∑–∞–º–µ–Ω–∏–ª LOWER() + LIKE** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ —Ç—Ä–∏–≥—Ä–∞–º–º
- **–ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞** - LIMIT 50 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤** (>500ms)

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### HTTP —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞)
- `/api/health`: **1.3-12ms** (—É–ª—É—á—à–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏)
- `/api/catalog/materials?search=–±–µ—Ç–æ–Ω`: **2.3ms** üöÄ
- `/api/catalog/works?search=—à—Ç—É–∫–∞—Ç—É—Ä–∫–∞`: **5.0ms** üöÄ

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **DDL –æ–ø–µ—Ä–∞—Ü–∏–∏**: 150-170ms (—Å—Ç–∞–±–∏–ª—å–Ω–æ)
- **–ü–æ–∏—Å–∫ —Å ILIKE**: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –∏–Ω–¥–µ–∫—Å–∞–º–∏ —Ç—Ä–∏–≥—Ä–∞–º–º
- **–ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π SELECT NOW() (~1.16s, —Å–µ—Ç–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞)

## üéØ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–π –®–∞–≥–∞ 2

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –°—Ç–∞—Ç—É—Å | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|--------|-----------|
| ‚úÖ –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç | **–ì–û–¢–û–í** | 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, keep-alive, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| ‚úÖ –°–µ—Ä–≤–µ—Ä –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ | **–ì–û–¢–û–í** | –°—Ç–∞–±–∏–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º |
| ‚úÖ –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã | **–ì–û–¢–û–í** | 8/9 –∏–Ω–¥–µ–∫—Å–æ–≤ (–∏—Å–∫–ª—é—á–µ–Ω category - –∫–æ–ª–æ–Ω–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç) |
| ‚úÖ –ü–æ–∏—Å–∫–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã —É—Å–∫–æ—Ä–µ–Ω—ã | **–ì–û–¢–û–í** | ILIKE —Å —Ç—Ä–∏–≥—Ä–∞–º–º–∞–º–∏: –º–∞—Ç–µ—Ä–∏–∞–ª—ã 2.3ms, —Ä–∞–±–æ—Ç—ã 5ms |
| ‚úÖ –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —É–º–µ–Ω—å—à–µ–Ω—ã | **–ì–û–¢–û–í** | DDL –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –Ω–æ—Ä–º–µ, —Ç–æ–ª—å–∫–æ —Å–µ—Ç–µ–≤–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –æ–±–ª–∞–∫–∞ |

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
1. **server/db/pool.js** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
2. **server/db/optimize_indexes.sql** - SQL —Å–∫—Ä–∏–ø—Ç—ã –∏–Ω–¥–µ–∫—Å–æ–≤  
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤** –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ë–î

### –ú–µ—Ç—Ä–∏–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–∏–ø–∞–º –æ–ø–µ—Ä–∞—Ü–∏–π
- –°—á–µ—Ç—á–∏–∫–∏ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- HTTP –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –®–∞–≥—É 3

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ì–û–¢–û–í**

–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞:
- –ü—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É
- –ò–Ω–¥–µ–∫—Å—ã —É—Å–∫–æ—Ä—è—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã  
- –ü–æ–∏—Å–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤/—Ä–∞–±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–Ω—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
- –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ CDN –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

---
*–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è*: 01.10.2025  
*–í—Ä–µ–º—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏*: ~15 –º–∏–Ω—É—Ç  
*–ò–Ω–¥–µ–∫—Å—ã*: 8 –∏–∑ 9 —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã*